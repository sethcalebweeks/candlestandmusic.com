---
import AudioPlayer from './AudioPlayer.svelte'
import { getCollection } from 'astro:content';
import { Icon } from 'astro-icon';

import albumsJSON from '../albums.json';

const tracks = (await getCollection('tracks'))
  .map(({slug, data}) => ({
    ...data,
    mp3: `/${slug.replace("_and_", "&")}.mp3`
  }))

const albums = albumsJSON.reduce((obj, {name}) => {
  obj[name] = tracks.filter(({album}) => album === name)
  return obj
}, {} as any)


---

<AudioPlayer client:load {albums}>
  <Icon name="ic:baseline-play-circle" class="w-6 h-6" slot="play" />
  <Icon name="ic:baseline-pause-circle" class="w-6 h-6" slot="pause" />
</AudioPlayer>